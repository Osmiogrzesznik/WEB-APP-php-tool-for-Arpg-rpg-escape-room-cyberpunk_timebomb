<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>DEVICES</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="https://openlayers.org/en/v4.6.5/css/ol.css" type="text/css">
    <script src="v4-6-5_build_ol.js" type="text/javascript"></script>

    <script>
        /* OSM & OL example code provided by https://mediarealm.com.au/ */
        var map;
        var mapLat = -33.829357;
        var mapLng = 150.961761;
        var mapDefaultZoom = 10;
        var vectorLayer;
        var atomIcons = {};

        function NuMap(mapLat,mapLng,mapDefaultZoom) {
            return new ol.Map({
                target: "map",
                layers: [
                    new ol.layer.Tile({
                        source: new ol.source.OSM({
                            url: "https://a.tile.openstreetmap.org/{z}/{x}/{y}.png"
                        })
                    })
                ],
                view: new ol.View({
                    center: ol.proj.fromLonLat([mapLng, mapLat]),
                    zoom: mapDefaultZoom
                })
            });
        }

        function add_map_point(lat, lng) {
            vectorLayer = new ol.layer.Vector({
                source: new ol.source.Vector({
                    features: [new ol.Feature({
                        geometry: new ol.geom.Point(ol.proj.transform([parseFloat(lng),
                            parseFloat(lat)
                        ], 'EPSG:4326', 'EPSG:3857')),
                    })]
                }),
                style: new ol.style.Style({
                    image: new ol.style.Icon({
                        anchor: [0.5, 0.5],
                        anchorXUnits: "fraction",
                        anchorYUnits: "fraction",
                        src: "https://upload.wikimedia.org/wikipedia/commons/e/ec/RedDot.svg"
                    })
                })
            });
            map.addLayer(vectorLayer);
        }

        function add_map_pointDevice(lat, lng) {

            var vectorLayer_active = new ol.layer.Vector({
                source: new ol.source.Vector({
                    features: [
                        new ol.Feature({
                            geometry: new ol.geom.Point(ol.proj.transform([parseFloat(lng),
                                parseFloat(lat)
                            ], 'EPSG:4326', 'EPSG:3857')),
                        }),
                        new ol.Feature({
                            geometry: new ol.geom.Point(ol.proj.transform([parseFloat(lng +
                                    0.01),
                                parseFloat(lat + 0.01)
                            ], 'EPSG:4326', 'EPSG:3857')),
                        })
                    ]
                }),
                style: new ol.style.Style({
                    image: new ol.style.Icon({
                        anchor: [0.5, 0.5],
                        anchorXUnits: "fraction",
                        anchorYUnits: "fraction",
                        src: "img/active.png"
                    })
                })
            });
            uuu = vectorLayer_active;
            map.addLayer(vectorLayer_active);
        }

        function NuLayer(arrayOfFeatures,style=null) {
            return new ol.layer.Vector({
                source: new ol.source.Vector({
                    features: arrayOfFeatures
                }),
                style: null
            });
        }



        function NuFeature(id,status, lat, lng) {
            let f = new ol.Feature({
                geometry: new ol.geom.Point(ol.proj.transform([parseFloat(lng),
                    parseFloat(lat)
                ], 'EPSG:4326', 'EPSG:3857')),
                id: id,
            });
            
            f.setStyle(NuStyle(id,status));
            return f;
        }

        function NuStyle(text,imagename){
            return new ol.style.Style({
                    image: atomIcons[imagename],
                    text: new ol.style.Text({
                        text:text,
                        offsetY: 20,
                        stroke: new ol.style.Stroke({
                            width: 2,
                            color: "#ffffff"
                        })
                    })
                })
        }

        function NuIcon(imagename){
            return new ol.style.Icon({
                        anchor: [0.5, 0.5],
                        anchorXUnits: "fraction",
                        anchorYUnits: "fraction",
                        src: "img/" + imagename + ".png"
                    })
        }


        function showDevices() {
            atomIcons = {
                disarmed: NuIcon("disarmed"),
                created: NuIcon("created"),
                active: NuIcon("active")
            }

            window.map = NuMap(mapLat, mapLng,mapDefaultZoom);
            disarmedStyle = NuStyle("disarmed","disarmed");
            createdStyle = NuStyle("created","created");
            activeStyle = NuStyle("active","active");
            c1 = NuFeature("bmb1","created", -33.8688, 151.2093);
            c2 = NuFeature("bmb2","created", -33.8588, 151.2193);
            c3 = NuFeature("bmb3","created", -33.8488, 151.2093);
            arrayOfFeatures_created = [c1, c2, c3];
            d1 = NuFeature("bmb4","disarmed", -33.7688, 151.2093);
            d2 = NuFeature("bmb5","disarmed", -33.7588, 151.2193);
            d3 = NuFeature("bmb6","disarmed", -33.7488, 151.2093);
            arrayOfFeatures_disarmed = [d1, d2, d3];
            dLayer = NuLayer(arrayOfFeatures_disarmed);
            cLayer = NuLayer(arrayOfFeatures_created);
            map.addLayer(dLayer);
            map.addLayer(cLayer);
            //add_map_pointDevice();
        }
    </script>
</head>

<body onload="showDevices()">
    <div id="map" style="width: 100vw; height: 100vh;"></div>
</body>

</html>